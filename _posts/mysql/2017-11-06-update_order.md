---
layout: post
title: UPDATE문 복수열 갱신 순서
published: True
categories: 
- sql
tags:
- database
- mysql
- oracle
- SQL 첫걸음
---


## UPDATE 명령
* UPDATE 명령은 이미 존재하는 행에 대해 값을 갱신하므로 이전의 값과 이후의 값의 두 가지 상태를 생각할 수 있다.
* UPDATE sample SET no = no + 1 에서 보면 이전의 no의 값에 1을 더한 값으로 이후의 no 열에 갱신한다.


## 복수열 갱신
* UPDATE 명령에는 복수의 열을 갱신할 수 있는데, 갱신할 식은 SET 구에 다음과 같이 콤마(,)로 구분하여 작성한다.
* 그런데, 아래와 같은 복수열 갱신을 하고자 할 때, 두 쿼리의 처리 순서가 다르며 결과 값에 차이가 있을까.
1. UPDATE sample SET no1 = no1 + 1, no2 = no1
2. UPDATE sample SET no2 = no1, no1 = no1 + 1
<br/>

* **정답은 데이터베이스 제품에 따라 다르다.**
* 대표적인 데이터베이스을 예로들면, mysql은 서로 다른 결과 값을 가지지만 oracle은 같은 결과를 가진다.
* 그러면 어떻게 처리되는지 본다.

## mysql 복수열 갱신 결과
* 먼저 다음과 같은 형태의 테이블이 있다고 치자.  

| no    | a                              |
| :-------- | :--------------------------------------- |
| 2         | 0 |
| 3         | 0 |

<br/>

* UPDATE sample SET no = no + 1, a = no 의 결과  
: no 열의 값에 1을 더하여 no 열에 저장한 뒤, 그 값이 다시 a 열에 대입!

| no    | a                              |
| :-------- | :--------------------------------------- |
| 3         | 3 |
| 4         | 4 |

* UPDATE sample SET a = no, no = no + 1 의 결과  
: no 열의 값을 a 열에 대입한 후, no 열의 값에 1을 더하여 no 열에 저장!

| no    | a                              |
| :-------- | :--------------------------------------- |
| 3         | 2 |
| 4         | 3 |

## oracle 복수열 갱신 결과
* oracle의 경우에는 갱신 식에 항상 갱신 이전의 값을 가지고 계산하기 때문에, SET 구에 기술한 식의 순서에 영향을 받지 않는다.
* 마찬가지로, 먼저 다음과 같은 형태의 테이블이 있다고 치자.  

| no    | a                              |
| :-------- | :--------------------------------------- |
| 2         | 0 |
| 3         | 0 |

<br/>

* UPDATE sample SET no = no + 1, a = no 의 결과  
: 갱신 이전의 no 열의 값에 1을 더하여 no열에 저장하고, 다시 갱신 이전의 no 열의 값을 a 열의 값에 저장!

| no    | a                              |
| :-------- | :--------------------------------------- |
| 3         | 2 |
| 4         | 3 |

* UPDATE sample SET a = no, no = no + 1 의 결과  
: 갱신 이전의 no 열의 값을 a 열에 저장한 후, 다시 갱신 이전의 no 열의 값에 1을 더하고 no 열에 대입!

| no    | a                              |
| :-------- | :--------------------------------------- |
| 3         | 2 |
| 4         | 3 |

## 결론
* mysql을 사용하는 경우 UPDATE 명령에 SET 구의 순서를 고려할 필요가 있다.
